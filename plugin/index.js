"use strict";var w=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.prototype.hasOwnProperty;var se=(t,e)=>{for(var n in e)w(t,n,{get:e[n],enumerable:!0})},re=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ne(e))!ie.call(t,i)&&i!==n&&w(t,i,{get:()=>e[i],enumerable:!(o=te(e,i))||o.enumerable});return t};var oe=t=>re(w({},"__esModule",{value:!0}),t);var ce={};se(ce,{default:()=>le});module.exports=oe(ce);var m=require("@babel/types");var H=["ActivityIndicator","View","Text","Image","ImageBackground","KeyboardAvoidingView","Pressable","ScrollView","FlatList","SectionList","Switch","TextInput","RefreshControl","TouchableHighlight","TouchableOpacity","VirtualizedList","Animated"],$=["react-native-reanimated/src/component","react-native-gesture-handler/src/components"],K=[],X={imports:[{name:"NativeText",isDefault:!1,path:"react-native/Libraries/Text/TextNativeComponent",mapTo:"NativeText"},{isDefault:!0,path:"react-native/Libraries/Components/View/ViewNativeComponent",mapTo:"NativeView"}]};var u=require("@babel/types");function R(t,e,n){let o=t.node.specifiers,i=t.node.source;t.node.importKind==="value"&&o.forEach(r=>{for(let a of n.imports){let c=!a.isDefault&&(0,u.isImportSpecifier)(r)||a.isDefault&&(0,u.isImportDefaultSpecifier)(r),f=a.isDefault||!a.isDefault&&a.name===r.local.name,S=a.path===i.value;if(!(!c||!f||!S)){if((0,u.isImportDefaultSpecifier)(r)){let x=(0,u.importDeclaration)([(0,u.importDefaultSpecifier)((0,u.identifier)(r.local.name))],(0,u.stringLiteral)(e.opts.isLocal&&e.file.opts.filename?e.file.opts.filename.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${a.mapTo}`)??"":`react-native-unistyles/components/native/${a.mapTo}`));t.replaceWith(x)}else{let x=(0,u.importDeclaration)([(0,u.importSpecifier)((0,u.identifier)(a.mapTo),(0,u.identifier)(a.mapTo))],(0,u.stringLiteral)(e.opts.isLocal&&e.file.opts.filename?e.file.opts.filename.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${a.mapTo}`)??"":`react-native-unistyles/components/native/${a.mapTo}`));t.node.specifiers=o.filter(I=>I!==r),t.node.specifiers.length===0?t.replaceWith(x):t.insertBefore(x)}return}}})}var b=require("@babel/types");function q(t,e){let n=Object.keys(e.reactNativeImports),o=Object.values(e.reactNativeImports),i=Object.entries(e.reactNativeImports),r=[];t.node.body.forEach(a=>{(0,b.isImportDeclaration)(a)&&a.source.value==="react-native"&&(a.specifiers=a.specifiers.filter(c=>!n.some(f=>f===c.local.name)),a.specifiers.length===0&&r.push(a))}),o.forEach(a=>{let c=t.node.body.find(f=>(0,b.isImportDeclaration)(f)&&f.source.value===`react-native-web/dist/exports/${a}`);c&&(c.specifiers=[])}),i.forEach(([a,c])=>{let f=(0,b.importDeclaration)([(0,b.importSpecifier)((0,b.identifier)(a),(0,b.identifier)(c))],(0,b.stringLiteral)(e.opts.isLocal?e.file.opts.filename?.split("react-native-unistyles").at(0)?.concat(`react-native-unistyles/components/native/${c}`)??"":`react-native-unistyles/components/native/${c}`));t.node.body.unshift(f)}),r.forEach(a=>t.node.body.splice(t.node.body.indexOf(a),1))}function N(t){return t.file.opts.filename?.includes("node_modules")}var A=require("@babel/types");function J(t){return t.node.openingElement.attributes.find(e=>(0,A.isJSXAttribute)(e)&&(0,A.isJSXIdentifier)(e.name,{name:"ref"})&&(0,A.isStringLiteral)(e.value))}var s=require("@babel/types"),d={Theme:0,ThemeName:1,AdaptiveThemes:2,Breakpoints:3,Variants:4,ColorScheme:5,Dimensions:6,Orientation:7,ContentSizeCategory:8,Insets:9,PixelRatio:10,FontScale:11,StatusBar:12,NavigationBar:13,Ime:14};function ae(t){let e=0;for(let o=0;o<t.length;o++)e=(e<<5)-e+t.charCodeAt(o),e|=0;return Math.abs(e)%1e9}function z(t,e){let{callee:n}=t.node;return(0,s.isMemberExpression)(n)&&(0,s.isIdentifier)(n.property)?n.property.name==="create"&&(0,s.isIdentifier)(n.object)&&n.object.name===e.file.styleSheetLocalName:!1}function Y(t,e){if(!e.file.forceProcessing&&!e.file.hasUnistylesImport)return!1;let{callee:n}=t.node;return(0,s.isMemberExpression)(n)&&(0,s.isIdentifier)(n.property)&&n.property.name==="create"&&(0,s.isIdentifier)(n.object)}function G(t,e){let n=e.filename?.replace(e.cwd,"")??"",o=ae(n)+ ++e.file.tagNumber;t.node.arguments.push((0,s.numericLiteral)(o))}function O(t){if(t){if((0,s.isIdentifier)(t))return{properties:[t.name]};if((0,s.isObjectPattern)(t))return{properties:t.properties.flatMap(n=>O(n)).flatMap(n=>n.properties)};if((0,s.isObjectProperty)(t)&&(0,s.isIdentifier)(t.value))return{properties:[t.key.name]};if((0,s.isObjectProperty)(t)&&(0,s.isObjectPattern)(t.value)){let e=t.value.properties.flatMap(n=>O(n));return{parent:t.key.name,properties:e.flatMap(n=>n.properties)}}}}function Q(t){let e=new Set,n=t.node.arguments[0];return(0,s.isObjectExpression)(n)&&n.properties.forEach(i=>{!(0,s.isObjectProperty)(i)||!(0,s.isIdentifier)(i.key)||((0,s.isObjectProperty)(i)&&(0,s.isObjectExpression)(i.value)&&i.value.properties.forEach(r=>{(0,s.isObjectProperty)(r)&&(0,s.isIdentifier)(r.key)&&(0,s.isIdentifier)(i.key)&&r.key.name==="variants"&&e.add({label:"variants",key:i.key.name})}),(0,s.isArrowFunctionExpression)(i.value)&&(0,s.isObjectExpression)(i.value.body)&&i.value.body.properties.forEach(r=>{(0,s.isObjectProperty)(r)&&(0,s.isIdentifier)(r.key)&&(0,s.isIdentifier)(i.key)&&r.key.name==="variants"&&e.add({label:"variants",key:i.key.name})}))}),Array.from(e).reduce((i,{key:r,label:a})=>i[r]?(i[r]=[...i[r],a],i):(i[r]=[a],i),{})}function Z(t){let e=t.get("arguments.0");if(!e)return;let n=e.node.params,[o,i]=n,r=[];if(o&&o.type==="ObjectPattern")for(let p of o.properties)r.push(O(p));o&&o.type==="Identifier"&&r.push({properties:[o.name]});let a=[];if(i&&i.type==="ObjectPattern")for(let p of i.properties)a.push(O(p));i&&i.type==="Identifier"&&a.push({properties:[i.name]});let c=null;if(e.get("body").isObjectExpression()?c=e.get("body"):e.traverse({ReturnStatement(p){!c&&p.get("argument").isObjectExpression()&&(c=p.get("argument"))}}),!c)return;let f=new Set;c.get("properties").forEach(p=>{let g=p.get("key");if(!g.isIdentifier())return;let h=g.node.name,v=p.get("value");v.isObjectExpression()&&v.get("properties").some(P=>{let E=P.get("key");return E.isIdentifier()&&E.node.name==="variants"})&&f.add({label:"variants",key:h}),v.isArrowFunctionExpression()&&(0,s.isObjectExpression)(v.node.body)&&v.node.body.properties.some(P=>(0,s.isIdentifier)(P.key)&&P.key.name==="variants")&&f.add({label:"variants",key:h})});let S=new Set;r.forEach(({properties:p})=>{p.forEach(g=>{let h=e.scope.getBinding(g);h&&h.referencePaths.forEach(v=>{let k=v.findParent(U=>U.isObjectProperty()&&U.parentPath===c);if(!k)return;let P=k.get("key"),E=P.isIdentifier()?P.node.name:P.isLiteral()?P.node.value:null;E&&S.add({label:"theme",key:E})})})});let x=new Set,I=(0,s.isIdentifier)(i)?i.name:void 0;a.forEach(({properties:p,parent:g})=>{p.forEach(h=>{let v=e.scope.getBinding(h);if(!v)return;let k=!!L(h),P=h;if(!k&&(!I||I&&I!==h)){if(!g||!L(g))return;P=g}v.referencePaths.forEach(E=>{let U=P;if(E.parentPath?.isMemberExpression()&&E.parentPath.get("object")===E){let T=E.parentPath,F=T.get("property");if(F.isIdentifier()&&(I&&(U=F.node.name),U==="insets"&&T.parentPath.isMemberExpression()&&T.parentPath.get("object")===T)){let W=T.parentPath.get("property");W.isIdentifier()&&W.node.name==="ime"&&(U="ime")}}let M=E.findParent(T=>T.isObjectProperty()&&T.parentPath===c);if(!M)return;let D=M.get("key"),B=D.isIdentifier()?D.node.name:D.isLiteral()?D.node.value:null;B&&x.add({label:U,key:B})})})});let j=Array.from(f),V=Array.from(S),y=Array.from(x);return V.concat(y).concat(j).reduce((p,{key:g,label:h})=>p[g]?(p[g]=[...p[g],h],p):(p[g]=[h],p),[])}function L(t){switch(t){case"theme":return d.Theme;case"themeName":return d.ThemeName;case"adaptiveThemes":return d.AdaptiveThemes;case"breakpoint":return d.Breakpoints;case"colorScheme":return d.ColorScheme;case"screen":return d.Dimensions;case"isPortrait":case"isLandscape":return d.Orientation;case"contentSizeCategory":return d.ContentSizeCategory;case"ime":return d.Ime;case"insets":return d.Insets;case"pixelRatio":return d.PixelRatio;case"fontScale":return d.FontScale;case"statusBar":return d.StatusBar;case"navigationBar":return d.NavigationBar;case"variants":return d.Variants}}function C(t,e=[]){return(0,s.isReturnStatement)(t)&&e.push(t),(0,s.isBlockStatement)(t)&&t.body.forEach(n=>{(0,s.isBlockStatement)(n)&&C(n,e)}),(0,s.isIfStatement)(t)&&(C(t.consequent,e),t.alternate&&C(t.alternate,e)),e}function _(t,e,n,o){let i=a=>{if(t.opts.debug){let c=a.map(f=>Object.keys(d).find(S=>d[S]===f)).join(", ");console.log(`${t.filename?.replace(`${t.file.opts.root}/`,"")}: styles.${e}: [${c}]`)}},r=o.map(L);if(r.length>0){let a=Array.from(new Set(r));i(a);let c=[];((0,s.isArrowFunctionExpression)(n.value)||(0,s.isFunctionExpression)(n.value))&&((0,s.isObjectExpression)(n.value.body)&&c.push(n.value.body),(0,s.isBlockStatement)(n.value.body)&&(c=C(n.value.body).map(f=>((0,s.isIdentifier)(f.argument)&&(f.argument=(0,s.objectExpression)([(0,s.spreadElement)(f.argument)])),f.argument)))),(0,s.isObjectExpression)(n.value)&&c.push(n.value),(0,s.isMemberExpression)(n.value)&&(n.value=(0,s.objectExpression)([(0,s.spreadElement)(n.value)]),c.push(n.value)),c.length>0&&c.forEach(f=>{f.properties.push((0,s.objectProperty)((0,s.identifier)("uni__dependencies"),(0,s.arrayExpression)(a.map(S=>(0,s.numericLiteral)(S)))))})}}var l=require("@babel/types");function ee(t,e){let n=t.node.body.filter(y=>(0,l.isExpressionStatement)(y)&&(0,l.isCallExpression)(y.expression)&&(0,l.isMemberExpression)(y.expression.callee));if(n.length===0)return;let o=n.find(y=>{if(!(0,l.isExpressionStatement)(y)||!(0,l.isCallExpression)(y.expression)||!(0,l.isMemberExpression)(y.expression.callee)||!(0,l.isIdentifier)(y.expression.callee.object))return!1;let p=y.expression.callee.object.name;return(0,l.isIdentifier)(y.expression.callee.object,{name:p})&&(0,l.isIdentifier)(y.expression.callee.property,{name:"useVariants"})&&y.expression.arguments.length===1});if(!o)return;let i=o.expression;if(!(0,l.isCallExpression)(i))return;let r=i.callee;if(!(0,l.isMemberExpression)(r)||!(0,l.isIdentifier)(r.object))return;let a=r.object.name,c=t.scope.generateUidIdentifier(a),f=(0,l.variableDeclaration)("const",[(0,l.variableDeclarator)(c,(0,l.identifier)(a))]),S=(0,l.callExpression)((0,l.memberExpression)((0,l.identifier)(c.name),(0,l.identifier)("useVariants")),i.arguments),x=(0,l.variableDeclaration)("const",[(0,l.variableDeclarator)((0,l.identifier)(a),S)]),I=t.node.body.findIndex(y=>y===o),j=t.node.body.slice(I+1),V=(0,l.blockStatement)([x,...j]);t.node.body=[...t.node.body.slice(0,I),f,V],e.file.hasVariants=!0}function le(){return{name:"babel-react-native-unistyles",visitor:{Program:{enter(t,e){e.file.replaceWithUnistyles=$.concat(e.opts.autoProcessPaths??[]).some(n=>e.filename?.includes(n)),e.file.hasAnyUnistyle=!1,e.file.hasUnistylesImport=!1,e.file.hasVariants=!1,e.file.styleSheetLocalName="",e.file.tagNumber=0,e.reactNativeImports={},e.file.forceProcessing=e.opts.autoProcessRoot&&e.filename?e.filename.includes(`${e.file.opts.root}/${e.opts.autoProcessRoot}/`):!1},exit(t,e){N(e)&&!e.file.replaceWithUnistyles||(e.file.hasAnyUnistyle||e.file.hasVariants||e.file.replaceWithUnistyles||e.file.forceProcessing)&&q(t,e)}},FunctionDeclaration(t,e){if(N(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},ClassDeclaration(t,e){if(N(e))return;(t.node.id?t.node.id.name:null)&&(e.file.hasVariants=!1)},VariableDeclaration(t,e){N(e)||t.node.declarations.forEach(n=>{((0,m.isArrowFunctionExpression)(n.init)||(0,m.isFunctionExpression)(n.init))&&(n.id&&n.id.type==="Identifier"&&n.id.name)&&(e.file.hasVariants=!1)})},ImportDeclaration(t,e){let n=K.concat(e.opts.autoRemapImports??[]).find(i=>e.filename?.includes(i.path));if(n)return R(t,e,n);if(N(e)&&!e.file.replaceWithUnistyles)return;let o=t.node.source.value;o.includes("react-native-unistyles")&&(e.file.hasUnistylesImport=!0,t.node.specifiers.forEach(i=>{(0,m.isImportSpecifier)(i)&&(0,m.isIdentifier)(i.imported)&&i.imported.name==="StyleSheet"&&(e.file.styleSheetLocalName=i.local.name)})),o==="react-native"&&t.node.specifiers.forEach(i=>{(0,m.isImportSpecifier)(i)&&(0,m.isIdentifier)(i.imported)&&H.includes(i.imported.name)&&(e.reactNativeImports[i.local.name]=i.imported.name)}),o.includes("react-native/Libraries")&&R(t,e,X),!e.file.forceProcessing&&Array.isArray(e.opts.autoProcessImports)&&(e.file.forceProcessing=e.opts.autoProcessImports.includes(o))},JSXElement(t,e){if(!N(e)&&J(t))throw new Error("Detected string based ref which is not supported by Unistyles.")},BlockStatement(t,e){N(e)||ee(t,e)},CallExpression(t,e){if(N(e)||!z(t,e)&&!Y(t,e))return;e.file.hasAnyUnistyle=!0,G(t,e);let n=t.node.arguments[0];if((0,m.isObjectExpression)(n)){let o=Q(t);o&&(0,m.isObjectExpression)(n)&&n.properties.forEach(i=>{(0,m.isObjectProperty)(i)&&(0,m.isIdentifier)(i.key)&&o[i.key.name]&&_(e,i.key.name,i,o[i.key.name])})}if((0,m.isArrowFunctionExpression)(n)||(0,m.isFunctionExpression)(n)){let o=Z(t);if(o){let i=(0,m.isBlockStatement)(n.body)?n.body.body.find(r=>(0,m.isReturnStatement)(r))?.argument:n.body;(0,m.isObjectExpression)(i)&&i.properties.forEach(r=>{(0,m.isObjectProperty)(r)&&(0,m.isIdentifier)(r.key)&&o[r.key.name]&&_(e,r.key.name,r,o[r.key.name])})}}}}}}
//# sourceMappingURL=index.js.map
